<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vermenigvuldigen — minimum v0.1 (met cijfer-rooster)</title>
<style>
  :root{ --bg:#f7f8fb; --card:#fff; --ink:#111; --line:#e5e7eb; --accent:#2563eb; --muted:#4b5563; }
  *{box-sizing:border-box}
  body{ margin:0; background:var(--bg); color:var(--ink); font-family:Arial, Helvetica, sans-serif; }
  .wrap{ max-width:900px; margin:auto; padding:20px; }
  .card{ background:#fff; border:1px solid var(--line); border-radius:12px; padding:16px; box-shadow:0 6px 20px rgba(0,0,0,.06); }
  h1{ margin:0 0 8px; font-size:22px; }
  p.lead{ margin:0 0 12px; color:var(--muted); }
  .bar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:10px; }
  button{ padding:10px 14px; border:none; border-radius:8px; background:var(--accent); color:#fff; font-weight:600; cursor:pointer; }
  .task{ font-size:24px; font-weight:700; margin:12px 0; }
  .controls{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:8px; }
  input[type="text"]{ padding:8px 10px; border:1px solid var(--line); border-radius:8px; min-width:200px; font-size:16px; }
  .ok{ background:#e6f7f1; border:1px solid #c7ecde; padding:8px 10px; border-radius:8px; margin-top:10px; }
  .err{ background:#fde8e8; border:1px solid #f7caca; padding:8px 10px; border-radius:8px; margin-top:10px; }
  .warn{ background:#fff7ed; border:1px solid #fed7aa; padding:8px 10px; border-radius:8px; margin-top:10px; }

  /* --- Rooster (cijferen) --- */
  .grid{ border-collapse:collapse; margin-top:8px; }
  .grid td{
    border:1px solid var(--line);
    width:32px; height:36px; text-align:center; vertical-align:middle;
  }
  .grid input{
    width:100%; height:100%;
    border:none; text-align:center; font-size:16px; outline:none;
  }
  .grid .label{ width:54px; background:#f8fafc; font-weight:700; }
  .grid .thick-top{ border-top:3px solid #111; }
  .grid .thick-bottom{ border-bottom:3px solid #111; }
  .grid .readonly{ background:#f3f4f6; color:#334155; }
</style>
</head>
<body>
<div class="wrap">
  <h1>Vermenigvuldigen — minimum (v0.1)</h1>
  <p class="lead">Rooster: 2 rijen voor de factoren, dikke streep, rijen voor tussenproducten, dikke streep, 1 rij voor som.</p>

  <div class="card">
    <div class="bar">
      <button id="btn-new">Nieuwe oefening</button>
    </div>

    <div class="task" id="task">—</div>

    <div class="controls">
      <label for="answer"><b>Antwoord:</b></label>
      <input type="text" id="answer" placeholder="bv. 123,45 of 123.45">
      <button id="btn-check">Nakijken</button>
    </div>

    <div id="grid"></div>

    <div id="feedback"></div>
  </div>
</div>

<script>
let current = null; // { a:{raw,decs}, b:{raw,decs}, productRaw, productDecs }

/* Helpers */
function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
function formatWithComma(rawStr, decs){
  let s = String(rawStr);
  if (decs <= 0) return s;
  if (s.length <= decs) s = s.padStart(decs+1, '0');
  const pos = s.length - decs;
  let out = s.slice(0,pos) + ',' + s.slice(pos);
  out = out.replace(/,?0+$/,'').replace(/,$/,'');
  return out;
}
function parseStudentAnswer(str){
  if (!str) return '';
  let s = String(str).trim().replace(/\s+/g,'').replace(/\./g,',');
  s = s.replace(/^0+(?=\d)/,'');
  return s;
}

/* Genereer één oefening */
function newExercise(){
  // eenvoudige mix
  const aDecs = randInt(0,2) <= 1 ? randInt(0,2) : 0;
  const bDecs = randInt(0,2);
  const aIntDigits = randInt(1,3);
  const bIntDigits = randInt(1,3);

  const aIntMin = aIntDigits===1 ? 0 : 10**(aIntDigits-1);
  const aIntMax = 10**aIntDigits - 1;
  const bIntMin = bIntDigits===1 ? 0 : 10**(bIntDigits-1);
  const bIntMax = 10**bIntDigits - 1;

  const aInt = randInt(aIntMin, aIntMax);
  const bInt = randInt(bIntMin, bIntMax);

  const aDecPart = aDecs>0 ? String(randInt(0,10**aDecs-1)).padStart(aDecs,'0') : '';
  const bDecPart = bDecs>0 ? String(randInt(0,10**bDecs-1)).padStart(bDecs,'0') : '';

  const aRaw = String(aInt) + aDecPart;
  const bRaw = String(bInt) + bDecPart;

  const productRaw = String(Number(aRaw) * Number(bRaw));
  const productDecs = aDecs + bDecs;

  current = {
    a: { raw: aRaw, decs: aDecs },
    b: { raw: bRaw, decs: bDecs },
    productRaw, productDecs
  };

  const aShown = formatWithComma(aRaw, aDecs);
  const bShown = formatWithComma(bRaw, bDecs);
  document.getElementById('task').textContent = `${aShown} × ${bShown} =`;
  document.getElementById('answer').value = '';
  document.getElementById('feedback').innerHTML = '';

  buildGrid(current);
}

/* Rooster met 2 operand-rijen, dikke lijn, tussenproducten, dikke lijn, som */
function buildGrid(item){
  const aDigits = item.a.raw.split('').map(Number);
  const bDigits = item.b.raw.split('').map(Number);
  const aLen = aDigits.length;
  const bLen = bDigits.length;

  const cols = Math.max(aLen, bLen) + (bLen - 1);

  const td = (html, extraClass='') => `<td class="${extraClass}">${html||''}</td>`;

  const rowWithNumber = (digits, label) => {
    const blanks = cols - digits.length;
    const cells = [
      td(label,'label'),
      ...Array.from({length: blanks}).map(()=>td('')),
      ...digits.map(d => td(`<input class="readonly" value="${d}" readonly>`))
    ];
    return `<tr>${cells.join('')}</tr>`;
  };
  const separatorRowTop = () => {
    const cells = [ td('', 'label thick-top') ]
      .concat(Array.from({length: cols}).map(()=>td('', 'thick-top')));
    return `<tr>${cells.join('')}</tr>`;
  };
  const partialRow = (rowIndexFromBottom) => {
    const shift = rowIndexFromBottom;
    const workCells = cols - shift;
    const cells = [
      td(`rij ${rowIndexFromBottom+1}`, 'label'),
      ...Array.from({length: workCells}).map(()=>td(`<input inputmode="numeric" pattern="[0-9]*" maxlength="1">`)),
      ...Array.from({length: shift}).map(()=>td(''))
    ];
    return `<tr>${cells.join('')}</tr>`;
  };
  const sumRow = () => {
    const cells = [
      td('som','label'),
      ...Array.from({length: cols}).map(()=>td(`<input inputmode="numeric" pattern="[0-9]*" maxlength="1">`))
    ];
    return `<tr>${cells.join('')}</tr>`;
  };

  let html = `<table class="grid">`;
  html += rowWithNumber(aDigits, '&times; a');
  html += rowWithNumber(bDigits, '&times; b');
  html += separatorRowTop();
  for (let k = 0; k < bLen; k++){ html += partialRow(k); }
  html += separatorRowTop();
  html += sumRow();
  html += `</table>`;

  document.getElementById("grid").innerHTML = html;
}

/* Nakijken (minimum) */
function checkAnswer(){
  if (!current) return;
  const correct = formatWithComma(current.productRaw, current.productDecs);
  const user = parseStudentAnswer(document.getElementById('answer').value);

  if (!user){
    document.getElementById('feedback').innerHTML = `<div class="warn">Vul eerst je antwoord in.</div>`;
    return;
  }
  const norm = s => s.replace(/\s/g,'').replace(/\./g,',').replace(/,?0+$/,'').replace(/,$/,'').replace(/^0+(?=\d)/,'');
  if (norm(user) === norm(correct)){
    document.getElementById('feedback').innerHTML = `<div class="ok">✔ Correct! Antwoord: <b>${correct}</b></div>`;
  }else{
    const digitsEq = user.replace(/[^\d]/g,'') === correct.replace(/[^\d]/g,'');
    if (digitsEq){
      document.getElementById('feedback').innerHTML = `<div class="warn">De cijfers kloppen, maar de komma lijkt verkeerd. Correct: <b>${correct}</b>.</div>`;
    }else{
      document.getElementById('feedback').innerHTML = `<div class="err">Niet juist. Correct: <b>${correct}</b>.</div>`;
    }
  }
}

/* Events */
window.addEventListener('DOMContentLoaded', ()=>{
  document.getElementById('btn-new').addEventListener('click', newExercise);
  document.getElementById('btn-check').addEventListener('click', checkAnswer);
  newExercise();
});
</script>
</body>
</html>
