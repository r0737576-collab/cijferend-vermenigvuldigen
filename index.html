<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vermenigvuldigen — cijferen (moeilijkheid + linkse kolom)</title>
<style>
  :root{
    --bg:#f7f8fb; --card:#ffffff; --ink:#111;
    --line:#cbd5e1; --accent:#2563eb; --muted:#4b5563;
  }
  *{ box-sizing:border-box; }
  body{ margin:0; background:var(--bg); color:var(--ink); font-family:Arial, Helvetica, sans-serif; }
  .wrap{ max-width:900px; margin:auto; padding:20px; }
  .card{ background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; box-shadow:0 6px 20px rgba(0,0,0,.06); }

  h1{ margin:0 0 8px; font-size:22px; }
  .lead{ margin:0 0 12px; color:var(--muted); }
  .bar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:10px; }
  select{ padding:8px 10px; border:1px solid #e5e7eb; border-radius:8px; background:#fff; }
  button{
    padding:10px 14px; border:none; border-radius:8px; background:var(--accent); color:#fff; font-weight:600; cursor:pointer;
  }
  input[type="text"]{
    padding:8px 10px; border:1px solid #e5e7eb; border-radius:8px; min-width:200px; font-size:16px;
  }
  .task{ font-size:24px; font-weight:700; margin:12px 0; }
  .controls{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin:8px 0; }

  /* --- Rooster --- */
  .grid{ border-collapse:collapse; margin-top:8px; }
  .grid td{
    border:1px solid var(--line);
    width:32px; height:36px; text-align:center; vertical-align:middle;
  }
  /* inputs zonder eigen rand -> tabel vormt de hokjes */
  .grid input{
    width:100%; height:100%;
    border:none; outline:none;
    background:transparent;
    text-align:center; font-size:16px;
  }
  /* ENKEL de uiterst linkse kolom lichtgrijs (klad/carry) */
  .grid td.first-col input{
    background:#f1f5f9; /* lichtgrijs */
    color:#0f172a;
  }

  /* dikke lijnen op rij-niveau (geen extra scheidingsrij) */
  .grid tr.thick-after td  { border-bottom:3px solid #111; }
  .grid tr.thick-before td { border-top:   3px solid #111; }

  .ok{ background:#e6f7f1; border:1px solid #c7ecde; padding:8px 10px; border-radius:8px; margin-top:10px; }
  .err{ background:#fde8e8; border:1px solid #f7caca; padding:8px 10px; border-radius:8px; margin-top:10px; }
  .warn{ background:#fff7ed; border:1px solid #fed7aa; padding:8px 10px; border-radius:8px; margin-top:10px; }
  .note{ margin-top:8px; font-size:13px; color:#334155; }
</style>
</head>
<body>
<div class="wrap">
  <h1>Vermenigvuldigen — cijferen</h1>
  <p class="lead">2 rijen voor de factoren (zonder komma), dikke lijn, evenveel rijen als cijfers van de 2e factor (tussenproducten), dikke lijn, 1 som-rij.</p>

  <div class="card">
    <div class="bar">
      <label for="difficulty"><b>Moeilijkheid:</b></label>
      <select id="difficulty">
        <option value="makkelijk">Makkelijk (10–100, max 1 dec)</option>
        <option value="gemiddeld">Gemiddeld (10–1000, max 2 dec)</option>
        <option value="moeilijk" selected>Moeilijk (10–1000, max 3 dec)</option>
        <option value="natuurlijk">Enkel natuurlijke getallen (10–1000)</option>
        <option value="compact">Compact (10–100, max 3 dec)</option>
      </select>

      <button id="btn-new">Nieuwe oefening</button>
    </div>

    <div class="task" id="task">—</div>

    <div class="controls">
      <label for="answer"><b>Eindantwoord:</b></label>
      <input id="answer" type="text" placeholder="bv. 123,45 of 123.45">
      <button id="btn-check">Nakijken</button>
    </div>

    <div id="grid"></div>
    <div id="grid-note" class="note"></div>

    <div id="feedback"></div>
  </div>
</div>

<script>
/* ===== Helpers ===== */
function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
function formatWithComma(rawStr, decs){
  let s = String(rawStr);
  if (decs <= 0) return s;
  if (s.length <= decs) s = s.padStart(decs+1, '0');
  const pos = s.length - decs;
  let out = s.slice(0,pos) + ',' + s.slice(pos);
  out = out.replace(/,?0+$/,'').replace(/,$/,''); // trim overbodige nullen
  return out;
}
function normalizeStudent(s){
  if(!s) return '';
  return String(s).trim()
    .replace(/\s+/g,'')
    .replace(/\./g,',')
    .replace(/^0+(?=\d)/,'')   // leidende nullen weg
    .replace(/,?0+$/,'')       // trailing nullen in decimalen
    .replace(/,$/,'');         // losse komma weg
}

/* ===== Moeilijkheidsconfig ===== */
const DIFF = {
  makkelijk: { min:10,  max:100,  decMax:1 },
  gemiddeld: { min:10,  max:1000, decMax:2 },
  moeilijk:  { min:10,  max:1000, decMax:3 },
  natuurlijk:{ min:10,  max:1000, decMax:0 },
  compact:   { min:10,  max:100,  decMax:3 }
};

let current = null;          // { a:{raw,decs}, b:{raw,decs}, productRaw, productDecs }
let currentDiff = 'moeilijk';

/* Maak factor binnen grenzen + decimalenregel (1000 => geen decimalen) */
function makeNumberBounded(cfg){
  const intPart = randInt(cfg.min, cfg.max);
  let decs = randInt(0, cfg.decMax);
  if (intPart === cfg.max) decs = 0; // 1000,xxx > 1000 → niet toegestaan

  const decPart = decs > 0
    ? String(randInt(0, Math.pow(10, decs) - 1)).padStart(decs, '0')
    : '';

  const raw = String(intPart) + decPart;       // digits only
  const shown = formatWithComma(raw, decs);    // met komma voor display
  return { raw, decs, shown };
}

/* ===== Oefening (1 per keer) ===== */
function newExercise(){
  const cfg = DIFF[currentDiff] || DIFF.moeilijk;

  const a = makeNumberBounded(cfg);
  const b = makeNumberBounded(cfg);

  const productRaw  = String(Number(a.raw) * Number(b.raw));
  const productDecs = a.decs + b.decs;

  current = {
    a:{ raw:a.raw, decs:a.decs },
    b:{ raw:b.raw, decs:b.decs },
    productRaw, productDecs
  };

  document.getElementById('task').textContent = `${a.shown} × ${b.shown} =`;

  document.getElementById('answer').value = '';
  document.getElementById('feedback').innerHTML = '';

  buildGrid(current);
}

/* ===== Rooster =====
   Kolommen: 1 (linkse klad/carry) + aLen + (shift rechts) --> cols = 1 + aLen + bLen
   Rijen:
   1) factor A (readonly, rechts uitgelijnd)
   2) factor B (readonly, rechts uitgelijnd) + dikke lijn eronder
   3) bLen rijen tussenproducten (invulbaar), met shift
      - kolom 0: grijze (invulbare) klad/carry
      - links van het core-blok: invulbare pads (normale kleur)
      - core-blok: aLen invulbare inputs
      - rechts: k invulbare shift-inputs
   4) som-rij (invulbaar), met dikke lijn erboven; kolom 0 grijs invulbaar
*/
function buildGrid(item){
  const aDigits = item.a.raw.split('').map(Number);
  const bDigits = item.b.raw.split('').map(Number);
  const aLen = aDigits.length;
  const bLen = bDigits.length;

  const cols = 1 + aLen + bLen;

  const td = (html='', cls='') => `<td class="${cls}">${html}</td>`;

  // Rij 1: factor A (rechts uitgelijnd; linkse grijze kolom readonly)
  const rowA = (() => {
    const blanks = (cols - 1) - aLen;
    const first = td(`<input class="first-col" value="" readonly>`, 'first-col');
    const left  = Array.from({length:blanks}).map(()=>td('')).join('');
    const body  = aDigits.map(d => td(`<input value="${d}" readonly>`)).join('');
    return `<tr>${first}${left}${body}</tr>`;
  })();

  // Rij 2: factor B (rechts uitgelijnd; linkse grijze kolom readonly) + dikke lijn eronder
  const rowB = (() => {
    const blanks = (cols - 1) - bLen;
    const first = td(`<input class="first-col" value="" readonly>`, 'first-col');
    const left  = Array.from({length:blanks}).map(()=>td('')).join('');
    const body  = bDigits.map(d => td(`<input value="${d}" readonly>`)).join('');
    return `<tr class="thick-after">${first}{left}${body}</tr>`.replace('{left}', left);
  })();

  // bLen rijen tussenproducten: linkse grijze kolom + invulbare pads + core + shift
  let partials = '';
  for (let k = 0; k < bLen; k++){
    const leftPadsCount = (cols - 1) - (aLen + k);
    const first = td(`<input class="first-col" inputmode="numeric" pattern="[0-9]*" maxlength="1">`, 'first-col');

    const leftPads = Array.from({length:leftPadsCount})
      .map(()=>td(`<input inputmode="numeric" pattern="[0-9]*" maxlength="1">`)).join('');

    const core  = Array.from({length:aLen})
      .map(()=>td(`<input inputmode="numeric" pattern="[0-9]*" maxlength="1">`)).join('');

    const shift = Array.from({length:k})
      .map(()=>td(`<input inputmode="numeric" pattern="[0-9]*" maxlength="1">`)).join('');

    partials += `<tr>${first}${leftPads}${core}${shift}</tr>`;
  }

  // Som-rij: linkse grijze kolom + rest invulbaar, dikke lijn erboven
  const rowSum = (() => {
    const first = td(`<input class="first-col" inputmode="numeric" pattern="[0-9]*" maxlength="1">`, 'first-col');
    const rest  = Array.from({length:cols-1})
      .map(()=>td(`<input inputmode="numeric" pattern="[0-9]*" maxlength="1">`)).join('');
    return `<tr class="thick-before">${first}${rest}</tr>`;
  })();

  const html =
    `<table class="grid">
       ${rowA}
       ${rowB}
       ${partials}
       ${rowSum}
     </table>`;

  document.getElementById("grid").innerHTML = html;

  document.getElementById("grid-note").textContent =
    'Opmerking: de lichtgrijze vakjes in de uiterst linkse kolom zijn bedoeld om tijdelijk meeneemcijfers (“onthouden”) te noteren.';
}

/* ===== Nakijken (alleen eindantwoord) ===== */
function checkAnswer(){
  if (!current) return;
  const correct = formatWithComma(current.productRaw, current.productDecs);
  const user = normalizeStudent(document.getElementById('answer').value);

  if (!user){
    document.getElementById('feedback').innerHTML = `<div class="warn">Vul eerst je antwoord in.</div>`;
    return;
  }
  const onlyDigits = s => String(s).replace(/[^\d]/g,'');
  if (normalizeStudent(user) === normalizeStudent(correct)){
    document.getElementById('feedback').innerHTML = `<div class="ok">✔ Correct! Antwoord: <b>${correct}</b></div>`;
  } else if (onlyDigits(user) === onlyDigits(correct)){
    document.getElementById('feedback').innerHTML =
      `<div class="warn">De cijfers kloppen, maar de <b>komma</b> lijkt verkeerd geplaatst. Correct: <b>${correct}</b>.</div>`;
  } else {
    document.getElementById('feedback').innerHTML = `<div class="err">Niet juist. Correct: <b>${correct}</b>.</div>`;
  }
}

/* ===== Events ===== */
window.addEventListener('DOMContentLoaded', ()=>{
  // Moeilijkheid
  const sel = document.getElementById('difficulty');
  sel.addEventListener('change', () => {
    currentDiff = sel.value;
    newExercise();
  });

  document.getElementById('btn-new').addEventListener('click', newExercise);
  document.getElementById('btn-check').addEventListener('click', checkAnswer);
  newExercise();
});
</script>
</body>
</html>
