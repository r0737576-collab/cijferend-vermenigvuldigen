<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vermenigvuldigen — oefenen met cijferen</title>

<style>
:root{
  --bg:#f7f8fb; --card:#fff; --ink:#111;
  --line:#e5e7eb; --accent:#2563eb;
}
body{
  margin:0; background:var(--bg); color:var(--ink);
  font-family:Arial, sans-serif;
}
.wrap{ max-width:1000px; margin:auto; padding:20px; }
.card{
  background:#fff; padding:16px; border-radius:12px; border:1px solid var(--line);
}
.bar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:8px; }

select{ padding:8px 10px; border:1px solid var(--line); border-radius:8px; background:#fff; }

button{
  padding:10px 14px;
  border:none; border-radius:8px;
  background:var(--accent);
  color:#fff; font-weight:600;
  cursor:pointer;
}

.task{ font-size:22px; font-weight:700; margin:10px 0; }

.grid{ border-collapse:collapse; }
.grid td{
  border:1px solid var(--line);
  width:32px; height:36px;
}
.grid input{
  width:100%; height:100%;
  border:none; text-align:center;
  font-size:16px; outline:none;
}

.ok{ background:#e6f7f1; padding:8px; border-radius:8px; }
.err{ background:#fde8e8; padding:8px; border-radius:8px; }
.warn{ background:#fff7ed; padding:8px; border-radius:8px; }

.nav{ margin-top:10px; display:flex; gap:10px; }
</style>
</head>

<body>
<div class="wrap">

  <h1>Vermenigvuldigen — oefenen met cijferen</h1>

  <div class="card">

    <!-- Bovenbalk -->
    <div class="bar">
      <label for="difficulty"><b>Moeilijkheid:</b></label>
      <select id="difficulty">
        <option value="makkelijk">Makkelijk</option>
        <option value="gemiddeld">Gemiddeld</option>
        <option value="moeilijk" selected>Moeilijk</option>
      </select>

      <button id="btn-new">Nieuwe set (5)</button>
      <button id="btn-print" style="background:#0f172a;">Print</button>
    </div>

    <div id="counter"></div>
    <div class="task" id="task"></div>

    <label for="est"><b>Schatting:</b></label>
    <input id="est" type="text" placeholder="bv. 1200 of 12,5">
    <button id="btn-start" style="background:#374151;">Start</button>

    <div id="work" style="display:none">
      <div id="grid" style="margin-top:10px;"></div>

      <div style="margin-top:10px">
        <label for="answer"><b>Eindantwoord:</b></label>
        <input id="answer" type="text" placeholder="bv. 123,45">
        <button id="btn-check">Nakijken</button>
      </div>

      <div id="feedback" style="margin-top:10px"></div>

      <div class="nav">
        <button id="prev" style="background:#374151;">Vorige</button>
        <button id="next" style="background:#374151;">Volgende</button>
      </div>
    </div>

  </div>
</div>

<script>
/* ================= CONFIG ================= */
const DIFFS = {
  makkelijk: { a:[1,2], b:[1,2], dec:[0,1] },
  gemiddeld: { a:[2,3], b:[1,3], dec:[0,2] },
  moeilijk:  { a:[3,5], b:[2,3], dec:[0,2] }
};

let diff = 'moeilijk';   // huidig niveau
let set = [];            // 5 opgaven
let index = 0;           // 0..4

/* ================= HELPERS ================= */
function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }

// maak getal met gegeven cijfers & decimalen (we tonen met komma, raw = cijferstring zonder komma)
function makeNumber(digRange, decRange){
  const d = rand(digRange[0], digRange[1]);
  const decimals = rand(decRange[0], decRange[1]);

  const minInt = Math.pow(10, Math.max(0, d-1));
  const maxInt = Math.pow(10, d)-1;
  let intPart = (d===1) ? rand(0,9) : rand(minInt, maxInt); // bij 1 cijfer: 0..9, anders 10^(d-1)..(10^d-1)

  if (decimals === 0) {
    return { shown:String(intPart), raw:String(intPart), decs:0 };
  }

  let decPart = String(rand(0, Math.pow(10,decimals)-1)).padStart(decimals, '0');
  return { shown: String(intPart)+','+decPart, raw: String(intPart)+decPart, decs: decimals };
}

// zet komma in raw product (raw = digits only)
function insertComma(raw, decs){
  if (decs <= 0) return raw;
  let s = String(raw);
  if (s.length <= decs) s = s.padStart(decs+1, '0');
  const pos = s.length - decs;
  return s.slice(0,pos) + ',' + s.slice(pos);
}

/* ================= SET ================= */
// bouw 5 opgaven op basis van huidig niveau
function newSet(){
  const cfg = DIFFS[diff];
  set = [];

  for(let i=0;i<5;i++){
    const a = makeNumber(cfg.a, cfg.dec);
    const b = makeNumber(cfg.b, cfg.dec);
    const productRaw = String(Number(a.raw) * Number(b.raw));
    const productDecs = a.decs + b.decs;
    set.push({
      a, b,
      product: productRaw,
      decs: productDecs
    });
  }
  index = 0;
  render();
}

/* ================= RENDER ================= */
function render(){
  const item = set[index];

  document.getElementById("counter").textContent = `Oefening ${index+1} van 5`;
  document.getElementById("task").textContent = `${item.a.shown} × ${item.b.shown} =`;

  // reset invoer
  document.getElementById("est").value = '';
  document.getElementById("answer").value = '';
  document.getElementById("feedback").innerHTML = '';
  document.getElementById("work").style.display = 'none';

  buildGrid(item);

  // nav-knoppen
  document.getElementById("prev").disabled = (index===0);
  document.getElementById("next").disabled = (index===4);
}

/* ================= GRID ================= */
// simpele rasteropbouw (cijferhokjes); didactisch rooster kun je later uitbreiden
function buildGrid(item){
  const aLen = item.a.raw.length;
  const bLen = item.b.raw.length;

  // eenvoudige rechthoek: rijen = bLen, kolommen = aLen + bLen (ruimte voor shifts/carries)
  const rows = bLen;
  const cols = aLen + bLen;

  let html = "<table class='grid'>";
  for(let r=0;r<rows;r++){
    html += "<tr>";
    for(let c=0;c<cols;c++){
      html += "<td><input inputmode='numeric' pattern='[0-9]*' maxlength='1'></td>";
    }
    html += "</tr>";
  }
  html += "</table>";

  document.getElementById("grid").innerHTML = html;
}

/* ================= START ================= */
function startExercise(){
  const est = document.getElementById("est").value.trim();
  if(!est){
    alert('Vul eerst je schatting in.');
    return;
  }
  document.getElementById("work").style.display = 'block';
}

/* ================= CHECK ================= */
function checkExercise(){
  const item = set[index];
  const user = document.getElementById("answer").value.trim().replace('.', ',');
  const correct = insertComma(item.product, item.decs);

  const fb = document.getElementById("feedback");
  if(user === correct){
    fb.innerHTML = `<div class="ok">✔ Correct! Antwoord: <b>${correct}</b></div>`;
  }else{
    // controle: zelfde cijfers zonder punctuatie -> waarschijnlijk kommafout
    const digitsEq = user.replace(/[^\d]/g,'') === correct.replace(/[^\d]/g,'');
    if(digitsEq){
      fb.innerHTML = `<div class="warn">⚠ De cijfers kloppen, maar de <b>komma</b> staat wellicht verkeerd. Dit product heeft <b>${item.decs}</b> kommacijfer(s). Correct is: <b>${correct}</b>.</div>`;
    }else{
      fb.innerHTML = `<div class="err">✖ Niet juist. Correct is: <b>${correct}</b>.</div>`;
    }
  }
}
  
<script>
  // Exporteer functies naar window (globale scope)
  if (typeof newSet === 'function')        window.newSet = newSet;
  if (typeof render === 'function')        window.render = render;
  if (typeof startExercise === 'function') window.startExercise = startExercise;
  if (typeof checkExercise === 'function') window.checkExercise = checkExercise;
  if (typeof nextEx === 'function')        window.nextEx = nextEx;
  if (typeof prevEx === 'function')        window.prevEx = prevEx;
</script>
  
/* ================= NAV ================= */
function nextEx(){ if(index<4){ index++; render(); } }
function prevEx(){ if(index>0){ index--; render(); } }

/* ================= EVENTS ================= */
document.getElementById("btn-new").addEventListener("click", newSet);
document.getElementById("btn-print").addEventListener("click", () => window.print());
document.getElementById("btn-start").addEventListener("click", startExercise);
document.getElementById("btn-check").addEventListener("click", checkExercise);
document.getElementById("next").addEventListener("click", nextEx);
document.getElementById("prev").addEventListener("click", prevEx);

// diff-wissel → nieuwe set
document.getElementById("difficulty").addEventListener("change", (e)=>{
  diff = e.target.value;
  newSet();
});

// init
newSet();
</script>

  <script>
  // Laat ons meteen weten als er JS-fouten zijn (F12 → Console)
  window.onerror = function (msg, src, line, col) {
    console.log('JS-fout:', msg, '@', src, line + ':' + col);
  };

  window.addEventListener('DOMContentLoaded', function(){
    // veiligheid: element bestaat?
    var btnNew   = document.getElementById('btn-new');
    var btnPrint = document.getElementById('btn-print');
    var btnStart = document.getElementById('btn-start');
    var btnCheck = document.getElementById('btn-check');
    var btnNext  = document.getElementById('next');
    var btnPrev  = document.getElementById('prev');
    var diffSel  = document.getElementById('difficulty');

    if (btnNew) {
      btnNew.addEventListener('click', function(){
        console.log('Klik op Nieuwe set → newSet()');
        if (typeof window.newSet === 'function') {
          window.newSet();
        } else {
          console.log('newSet() niet gevonden op window');
          alert('Kon newSet() niet vinden — controleer of het exportblok boven dit script staat.');
        }
      });
    }

    if (diffSel) {
      diffSel.addEventListener('change', function(e){
        console.log('Moeilijkheid →', e.target.value);
        // update je eigen diff-variabele én rebuild set
        try { window.diff = e.target.value; } catch(_) {}
        if (typeof window.newSet === 'function') window.newSet();
      });
    }

    if (btnStart) btnStart.addEventListener('click', function(){ if (typeof window.startExercise === 'function') window.startExercise(); });
    if (btnCheck) btnCheck.addEventListener('click', function(){ if (typeof window.checkExercise === 'function') window.checkExercise(); });
    if (btnNext)  btnNext.addEventListener('click', function(){ if (typeof window.nextEx === 'function') window.nextEx(); });
    if (btnPrev)  btnPrev.addEventListener('click', function(){ if (typeof window.prevEx === 'function') window.prevEx(); });
    if (btnPrint) btnPrint.addEventListener('click', function(){ window.print(); });

    // Optioneel: meteen bij laden 1 set tonen
    if (typeof window.newSet === 'function') {
      console.log('Init → newSet()');
      window.newSet();
    }
  });
</script>
  
</body>
</html>
